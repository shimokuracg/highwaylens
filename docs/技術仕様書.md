# SlopeGuard 技術仕様書

**バージョン**: 0.1.0
**最終更新**: 2026年2月11日
**対象ユーザー**: NEXCO中日本

---

## 目次

1. [システム概要](#1-システム概要)
2. [システム構成](#2-システム構成)
3. [データソース](#3-データソース)
4. [リスク計算アルゴリズム](#4-リスク計算アルゴリズム)
5. [API仕様](#5-api仕様)
6. [ダッシュボード機能](#6-ダッシュボード機能)
7. [運用ガイド](#7-運用ガイド)

---

## 1. システム概要

### 1.1 目的

SlopeGuardは、高速道路沿線の斜面崩壊リスクを衛星データと複数のデータソースを統合して予測する監視システムです。

### 1.2 主要機能

| 機能 | 説明 |
|------|------|
| 地盤変動検出 | Sentinel-1衛星InSARによるミリメートル精度の変動検出 |
| リスクスコア算出 | 6要因を統合した0-100のリスクスコア |
| 警戒レベル分類 | 4段階（異常なし/経過観察/要注意/要対応）の分類 |
| インタラクティブ地図 | リアルタイム監視ダッシュボード |
| 日英対応 | 日本語・英語切り替え可能なUI |

### 1.3 監視対象

| 高速道路 | 区間 | セグメント数 | 状態 |
|----------|------|-------------|------|
| 東名高速道路 | 神奈川県〜静岡県 | 約140箇所 | 運用中 |
| 中央自動車道 | 計画中 | - | 計画中 |

---

## 2. システム構成

### 2.1 アーキテクチャ図

```
┌─────────────────────────────────────────────────────────────┐
│                    外部データソース                           │
├─────────────┬─────────────┬─────────────┬─────────────┬─────┤
│ Sentinel-1  │  SRTM DEM   │  気象庁     │   地質調査所 │ OSM │
│   (ESA)     │   (USGS)    │  (AMeDAS)   │    (GSI)    │     │
└──────┬──────┴──────┬──────┴──────┬──────┴──────┬──────┴──┬──┘
       │             │             │             │         │
       ▼             ▼             ▼             ▼         ▼
┌─────────────────────────────────────────────────────────────┐
│                  データ取得レイヤー                           │
└────────────────────────────┬────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                    処理レイヤー                               │
│            InSAR解析 / 傾斜計算 / データ統合                   │
└────────────────────────────┬────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                   分析レイヤー                                │
│              リスクスコア算出エンジン                          │
└────────────────────────────┬────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                   APIレイヤー (FastAPI)                       │
└────────────────────────────┬────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                 ダッシュボード (Leaflet.js)                   │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 技術スタック

| コンポーネント | 技術 | 用途 |
|---------------|------|------|
| バックエンドAPI | FastAPI + Uvicorn | REST APIサーバー |
| リスク計算 | Python + NumPy | リスクスコア算出 |
| 地理空間処理 | Rasterio, GeoPandas | 空間解析 |
| InSAR処理 | ESA SNAP GPT | 干渉SAR処理 |
| フロントエンド | HTML + Leaflet.js | 地図ダッシュボード |

---

## 3. データソース

### 3.1 Sentinel-1衛星データ

| 項目 | 値 |
|------|-----|
| 衛星 | Sentinel-1A/B（ESA） |
| 周波数帯 | Cバンド（5.405 GHz） |
| 波長 | 5.5465 cm |
| 分解能 | 5m × 20m（IWモード） |
| 回帰周期 | 12日 |
| データ提供元 | Alaska Satellite Facility (ASF) |

**変位計算式:**
```
変位(mm) = 位相(rad) × 波長 / (4π)
         = 位相 × 5.5465 / (4π)
         ≈ 位相 × 0.441 mm/rad
```

### 3.2 数値標高モデル（DEM）

| 項目 | 値 |
|------|-----|
| データソース | SRTM 1秒メッシュ |
| 解像度 | 30メートル |
| フォーマット | HGT（符号付き16ビット整数） |

**傾斜計算（Hornの方法）:**
```
傾斜角(度) = arctan(√(dz/dx² + dz/dy²)) × 180/π
```

### 3.3 気象データ

| 項目 | 値 |
|------|-----|
| データソース | 気象庁 |
| 観測網 | AMeDAS（アメダス） |
| 観測項目 | 降水量、気温、湿度、風速 |
| 更新間隔 | 10分 |

**監視パラメータ:**
- 48時間累積降水量（mm）
- 7日間累積降水量（mm）

### 3.4 地質データ

| 項目 | 値 |
|------|-----|
| データソース | 産業技術総合研究所 地質調査総合センター |
| 分類 | 岩石・土壌タイプ |

**地質リスク分類表:**

| 地質タイプ | リスクスコア | 安定性 |
|-----------|-------------|--------|
| 花崗岩 | 15 | 安定 |
| 安山岩 | 20 | 安定 |
| 玄武岩 | 20 | 安定 |
| 砂岩 | 35 | やや注意 |
| 頁岩 | 45 | やや注意 |
| 泥岩 | 55 | 要注意 |
| 凝灰岩 | 50 | 要注意 |
| 火山灰 | 65 | 要注意 |
| 崖錐 | 75 | 要注意 |
| 沖積層 | 60 | 要注意 |
| 盛土 | 85 | 危険 |
| 地すべり堆積物 | 90 | 危険 |

### 3.5 災害履歴データ

| 項目 | 値 |
|------|-----|
| データソース | 国土交通省、NEXCO中日本 |
| 対象 | 東名・中央道沿線の過去の斜面災害 |
| パラメータ | 位置、発生日、種類、規模 |

---

## 4. リスク計算アルゴリズム

### 4.1 重み付け要因モデル

リスクスコアは6つの要因の重み付け合計として計算されます：

| 要因 | 重み | 説明 |
|------|------|------|
| 変動速度 | 35% | InSAR速度（mm/年） |
| 変動加速度 | 20% | 変動速度の変化率（mm/年²） |
| 傾斜角 | 15% | DEMから算出（度） |
| 降雨 | 15% | 48時間累積降水量（mm） |
| 地質 | 10% | 岩石・土壌の安定性 |
| 災害履歴 | 5% | 周辺の過去災害記録 |

**計算式:**
```
リスクスコア = 0.35×変動速度 + 0.20×加速度 + 0.15×傾斜
             + 0.15×降雨 + 0.10×地質 + 0.05×履歴
```

### 4.2 要因別スコアリング

#### 変動速度（mm/年）

| 速度 | スコア |
|------|--------|
| 2未満 | 0-10 |
| 2-5 | 10-30 |
| 5-10 | 30-60 |
| 10-20 | 60-80 |
| 20-30 | 80-90 |
| 30超 | 90-100 |

#### 傾斜角（度）

| 傾斜 | スコア |
|------|--------|
| 10°未満 | 0-10 |
| 10-20° | 10-30 |
| 20-30° | 30-50 |
| 30-40° | 50-80 |
| 40-50° | 80-95 |
| 50°超 | 95-100 |

#### 48時間降雨量（mm）

| 降水量 | スコア |
|--------|--------|
| 10未満 | 0-10 |
| 10-30 | 10-40 |
| 30-80 | 40-80 |
| 80-150 | 80-94 |
| 150超 | 94-100 |

### 4.3 警戒レベル

| レベル | スコア範囲 | 表示 | 対応 |
|--------|-----------|------|------|
| GREEN | 0-25 | 異常なし | 通常監視継続 |
| YELLOW | 26-50 | 経過観察 | 監視強化 |
| ORANGE | 51-75 | 要注意 | 現地点検推奨 |
| RED | 76-100 | 要対応 | 緊急対応必要 |

### 4.4 データ品質チェック

- **最小コヒーレンス閾値**: 0.3
- コヒーレンスが0.3未満の場合、結果は「データ不足」として表示
- 信頼性フラグで結果の確実性を表示

---

## 5. API仕様

### 5.1 ベースURL

```
http://localhost:8000
```

### 5.2 エンドポイント一覧

| メソッド | パス | 説明 |
|----------|------|------|
| GET | /api/v1/segments | 全監視セグメント取得 |
| GET | /api/v1/segments/{id} | 特定セグメント取得 |
| GET | /api/v1/alerts | アクティブアラート取得 |
| GET | /api/v1/geojson | GeoJSON形式で取得 |
| GET | /api/v1/stats | システム統計取得 |
| GET | /dashboard | ダッシュボード表示 |
| GET | /health | ヘルスチェック |
| GET | /docs | API仕様書（Swagger UI） |

### 5.3 レスポンス例

#### GET /api/v1/segments

```json
[
  {
    "segment_id": "SLOPE_0001",
    "lat": 35.4521,
    "lon": 139.0234,
    "score": 67,
    "level": "orange",
    "message": "【警戒】現地点検を推奨します",
    "coherence": 0.85,
    "timestamp": "2026-02-11T10:30:00Z",
    "is_reliable": true,
    "insights": [
      {
        "icon": "📡",
        "label": "衛星観測",
        "value": "地盤変動を検出",
        "detail": "年間 15mm の動き",
        "severity": "medium"
      },
      {
        "icon": "⛰️",
        "label": "地形",
        "value": "急傾斜地",
        "detail": "傾斜角 35°",
        "severity": "high"
      }
    ]
  }
]
```

#### GET /api/v1/stats

```json
{
  "total_segments": 140,
  "segments_by_level": {
    "red": 2,
    "orange": 15,
    "yellow": 45,
    "green": 78
  },
  "average_score": 32.5,
  "high_risk_count": 17,
  "last_updated": "2026-02-11T10:30:00Z"
}
```

---

## 6. ダッシュボード機能

### 6.1 主要機能

| 機能 | 説明 |
|------|------|
| 監視状況サマリー | リスクレベル別の件数表示 |
| 対応必要箇所一覧 | 要注意・要対応セグメントのリスト |
| インタラクティブ地図 | マーカー付き地図表示 |
| 観測範囲表示 | 衛星観測カバレッジの切り替え表示 |
| 言語切り替え | 日本語/英語の切り替え |
| セグメント詳細 | クリックで詳細ポップアップ表示 |

### 6.2 カラースキーム

| レベル | 色 | カラーコード |
|--------|-----|-------------|
| 要対応（RED） | 赤 | #ef4444 |
| 要注意（ORANGE） | オレンジ | #f97316 |
| 経過観察（YELLOW） | 黄 | #eab308 |
| 異常なし（GREEN） | 緑 | #22c55e |
| データ不足 | グレー | #9ca3af |

### 6.3 データ更新周期

| 項目 | 周期 |
|------|------|
| 衛星観測 | 12日（Sentinel-1回帰周期） |
| 気象データ | 10分（AMeDAS更新間隔） |
| リスク再計算 | 60秒（APIキャッシュ） |
| ダッシュボード更新 | 60秒（自動リフレッシュ） |

---

## 7. 運用ガイド

### 7.1 システム起動

```bash
# 仮想環境の有効化
cd /Users/cgs/dxaccelprog2025/slopeguard
source venv/bin/activate

# APIサーバー起動
uvicorn src.api.main:app --host 0.0.0.0 --port 8000

# ブラウザでダッシュボードにアクセス
# http://localhost:8000/dashboard
```

### 7.2 システム要件

| 項目 | 要件 |
|------|------|
| Python | 3.11以上 |
| メモリ | 8GB以上（InSAR処理時） |
| ディスク | 50GB以上（衛星データ保存用） |
| ネットワーク | インターネット接続必須 |

### 7.3 監視対象の選定基準

- 傾斜角10度以上の斜面のみを監視対象
- 高速道路中心線から300m以内
- 200m間隔でサンプリング

### 7.4 精度と制限事項

#### 精度

| 測定項目 | 精度 |
|----------|------|
| InSAR地盤変動 | ±2-5 mm/年 |
| DEM標高 | ±5 m |
| 傾斜角 | ±2° |
| 位置精度 | ±30 m |

#### 制限事項

1. **InSARコヒーレンス低下**
   - 植生が密な地域では精度が低下する場合があります

2. **時間分解能**
   - 衛星観測は12日周期であり、リアルタイム監視ではありません

3. **気象データ遅延**
   - 気象庁データはリアルタイムから10-20分の遅延があります

4. **地質データ解像度**
   - 地質分類は広域的であり、局所的な変化を捉えられない場合があります

---

## 付録A: 用語集

| 用語 | 説明 |
|------|------|
| InSAR | Interferometric Synthetic Aperture Radar（干渉合成開口レーダー） |
| コヒーレンス | InSARデータの品質指標（0-1、高いほど良い） |
| DEM | Digital Elevation Model（数値標高モデル） |
| AMeDAS | Automated Meteorological Data Acquisition System（アメダス） |
| GSI | Geological Survey of Japan（地質調査総合センター） |

---

## 付録B: 問い合わせ先

**開発チーム**: 高速道路DXアクセラレーションプログラム2025
**対象組織**: NEXCO中日本

---

*本文書はシステムの進化に伴い更新される場合があります。*
