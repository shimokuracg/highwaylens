<?xml version="1.0" encoding="UTF-8"?>
<graph id="Simple_Coregistration">
    <version>1.0</version>

    <!-- Read Master -->
    <node id="Read-Master">
        <operator>Read</operator>
        <sources/>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <file>${masterFile}</file>
        </parameters>
    </node>

    <!-- Read Slave -->
    <node id="Read-Slave">
        <operator>Read</operator>
        <sources/>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <file>${slaveFile}</file>
        </parameters>
    </node>

    <!-- TOPS Split Master - IW2 subswath -->
    <node id="TOPSAR-Split-Master">
        <operator>TOPSAR-Split</operator>
        <sources>
            <sourceProduct refid="Read-Master"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <subswath>IW2</subswath>
            <selectedPolarisations>VV</selectedPolarisations>
            <firstBurstIndex>1</firstBurstIndex>
            <lastBurstIndex>3</lastBurstIndex>
        </parameters>
    </node>

    <!-- TOPS Split Slave -->
    <node id="TOPSAR-Split-Slave">
        <operator>TOPSAR-Split</operator>
        <sources>
            <sourceProduct refid="Read-Slave"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <subswath>IW2</subswath>
            <selectedPolarisations>VV</selectedPolarisations>
            <firstBurstIndex>1</firstBurstIndex>
            <lastBurstIndex>3</lastBurstIndex>
        </parameters>
    </node>

    <!-- Apply Orbit File Master -->
    <node id="Apply-Orbit-Master">
        <operator>Apply-Orbit-File</operator>
        <sources>
            <sourceProduct refid="TOPSAR-Split-Master"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <orbitType>Sentinel Precise (Auto Download)</orbitType>
            <continueOnFail>true</continueOnFail>
        </parameters>
    </node>

    <!-- Apply Orbit File Slave -->
    <node id="Apply-Orbit-Slave">
        <operator>Apply-Orbit-File</operator>
        <sources>
            <sourceProduct refid="TOPSAR-Split-Slave"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <orbitType>Sentinel Precise (Auto Download)</orbitType>
            <continueOnFail>true</continueOnFail>
        </parameters>
    </node>

    <!-- Back-Geocoding (Coregistration) -->
    <node id="Back-Geocoding">
        <operator>Back-Geocoding</operator>
        <sources>
            <sourceProduct refid="Apply-Orbit-Master"/>
            <sourceProduct.1 refid="Apply-Orbit-Slave"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <demName>SRTM 3Sec</demName>
            <demResamplingMethod>BILINEAR_INTERPOLATION</demResamplingMethod>
            <resamplingType>BILINEAR_INTERPOLATION</resamplingType>
            <maskOutAreaWithoutElevation>false</maskOutAreaWithoutElevation>
            <outputDerampDemodPhase>true</outputDerampDemodPhase>
        </parameters>
    </node>

    <!-- Simple Interferogram -->
    <node id="Interferogram">
        <operator>Interferogram</operator>
        <sources>
            <sourceProduct refid="Back-Geocoding"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <subtractFlatEarthPhase>true</subtractFlatEarthPhase>
            <includeCoherence>true</includeCoherence>
            <cohWinAz>5</cohWinAz>
            <cohWinRg>20</cohWinRg>
        </parameters>
    </node>

    <!-- TOPS Deburst -->
    <node id="TOPSAR-Deburst">
        <operator>TOPSAR-Deburst</operator>
        <sources>
            <sourceProduct refid="Interferogram"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <selectedPolarisations>VV</selectedPolarisations>
        </parameters>
    </node>

    <!-- Write Output -->
    <node id="Write">
        <operator>Write</operator>
        <sources>
            <sourceProduct refid="TOPSAR-Deburst"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <file>${outputFile}</file>
            <formatName>BEAM-DIMAP</formatName>
        </parameters>
    </node>
</graph>
