<?xml version="1.0" encoding="UTF-8"?>
<graph id="InSAR_Processing">
    <version>1.0</version>

    <!-- Read Master -->
    <node id="Read-Master">
        <operator>Read</operator>
        <sources/>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <file>${masterFile}</file>
        </parameters>
    </node>

    <!-- Read Slave -->
    <node id="Read-Slave">
        <operator>Read</operator>
        <sources/>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <file>${slaveFile}</file>
        </parameters>
    </node>

    <!-- TOPS Split Master - IW2 subswath (covers Sasago area) -->
    <node id="TOPSAR-Split-Master">
        <operator>TOPSAR-Split</operator>
        <sources>
            <sourceProduct refid="Read-Master"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <subswath>IW2</subswath>
            <selectedPolarisations>VV</selectedPolarisations>
        </parameters>
    </node>

    <!-- TOPS Split Slave -->
    <node id="TOPSAR-Split-Slave">
        <operator>TOPSAR-Split</operator>
        <sources>
            <sourceProduct refid="Read-Slave"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <subswath>IW2</subswath>
            <selectedPolarisations>VV</selectedPolarisations>
        </parameters>
    </node>

    <!-- Apply Orbit File Master -->
    <node id="Apply-Orbit-Master">
        <operator>Apply-Orbit-File</operator>
        <sources>
            <sourceProduct refid="TOPSAR-Split-Master"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <orbitType>Sentinel Precise (Auto Download)</orbitType>
            <polyDegree>3</polyDegree>
            <continueOnFail>true</continueOnFail>
        </parameters>
    </node>

    <!-- Apply Orbit File Slave -->
    <node id="Apply-Orbit-Slave">
        <operator>Apply-Orbit-File</operator>
        <sources>
            <sourceProduct refid="TOPSAR-Split-Slave"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <orbitType>Sentinel Precise (Auto Download)</orbitType>
            <polyDegree>3</polyDegree>
            <continueOnFail>true</continueOnFail>
        </parameters>
    </node>

    <!-- Back-Geocoding (Coregistration) -->
    <node id="Back-Geocoding">
        <operator>Back-Geocoding</operator>
        <sources>
            <sourceProduct refid="Apply-Orbit-Master"/>
            <sourceProduct.1 refid="Apply-Orbit-Slave"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <demName>SRTM 1Sec HGT</demName>
            <demResamplingMethod>BILINEAR_INTERPOLATION</demResamplingMethod>
            <resamplingType>BILINEAR_INTERPOLATION</resamplingType>
            <maskOutAreaWithoutElevation>true</maskOutAreaWithoutElevation>
            <outputDerampDemodPhase>false</outputDerampDemodPhase>
        </parameters>
    </node>

    <!-- Interferogram Formation -->
    <node id="Interferogram">
        <operator>Interferogram</operator>
        <sources>
            <sourceProduct refid="Back-Geocoding"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <subtractFlatEarthPhase>true</subtractFlatEarthPhase>
            <srpPolynomialDegree>5</srpPolynomialDegree>
            <srpNumberPoints>501</srpNumberPoints>
            <orbitDegree>3</orbitDegree>
            <includeCoherence>true</includeCoherence>
            <cohWinAz>10</cohWinAz>
            <cohWinRg>10</cohWinRg>
        </parameters>
    </node>

    <!-- TOPS Deburst -->
    <node id="TOPSAR-Deburst">
        <operator>TOPSAR-Deburst</operator>
        <sources>
            <sourceProduct refid="Interferogram"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <selectedPolarisations>VV</selectedPolarisations>
        </parameters>
    </node>

    <!-- Topographic Phase Removal -->
    <node id="TopoPhaseRemoval">
        <operator>TopoPhaseRemoval</operator>
        <sources>
            <sourceProduct refid="TOPSAR-Deburst"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <demName>SRTM 1Sec HGT</demName>
            <orbitDegree>3</orbitDegree>
            <tileExtensionPercent>100</tileExtensionPercent>
        </parameters>
    </node>

    <!-- Goldstein Phase Filtering -->
    <node id="GoldsteinPhaseFiltering">
        <operator>GoldsteinPhaseFiltering</operator>
        <sources>
            <sourceProduct refid="TopoPhaseRemoval"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <alpha>1.0</alpha>
            <FFTSizeString>64</FFTSizeString>
            <windowSizeString>3</windowSizeString>
            <useCoherenceMask>false</useCoherenceMask>
            <coherenceThreshold>0.2</coherenceThreshold>
        </parameters>
    </node>

    <!-- Write Output -->
    <node id="Write">
        <operator>Write</operator>
        <sources>
            <sourceProduct refid="GoldsteinPhaseFiltering"/>
        </sources>
        <parameters class="com.bc.ceres.binding.dom.XppDomElement">
            <file>${outputFile}</file>
            <formatName>BEAM-DIMAP</formatName>
        </parameters>
    </node>
</graph>
